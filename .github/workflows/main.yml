name: Build IPA for TrollStore
on: [push]
jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
      
      - name: Setup Capacitor & iOS
        run: |
          npm install @capacitor/cli @capacitor/core @capacitor/ios
          # Tự động tạo cấu hình nếu chưa có
          npx cap init "BTC Manager" com.btcmanager.app --web-dir www --confirm
          npx cap add ios
          
      - name: Build Xcode Project
        run: |
          npx cap copy ios
          # Build ở chế độ Debug để phù hợp với TrollStore
          xcodebuild -workspace ios/App/App.xcworkspace -scheme App -configuration Debug -sdk iphoneos -derivedDataPath build
          
      - name: Create IPA Package
        run: |
          mkdir -p Payload
          cp -r build/Build/Products/Debug-iphoneos/App.app Payload/
          zip -r BTC_Manager.ipa Payload
          
      - name: Export File IPA
        uses: actions/upload-artifact@v4
        with:
          name: App-TrollStore
          path: BTC_Manager.ipa
